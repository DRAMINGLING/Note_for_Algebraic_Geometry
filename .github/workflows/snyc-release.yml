name: Sync Releases

on:
  workflow_dispatch:  # 手动触发
  release:
    types: [published]  # 源仓库发布时触发

jobs:
  push-pdf:
    runs-on: ubuntu-latest
    steps:
      - name: Download PDF from release
        run: |
          RELEASE_TAG="${{ github.event.release.release }}"
          PDF_URL="https://github.com/${{ github.repository }}/releases/download/${RELEASE_TAG}/main.pdf"
          
          # 下载PDF并重命名为目标名称
          curl -L -o "Note for Algebraic Varieties.pdf" "${PDF_URL}"
          
          if [ ! -f "Note for Algebraic Varieties.pdf" ]; then
            echo "Error: PDF not downloaded!"
            exit 1
          fi
          
          echo "File downloaded and renamed successfully"
          ls -la "Note for Algebraic Varieties.pdf"

      - name: Push to Documents Repository
        uses: cpina/github-action-push-to-another-repository@v1.8.0
        env:
          API_TOKEN_GITHUB: ${{ secrets.UPDATE_TEX_FILE }}
        with:
          # ⚠️ 修改为目标仓库信息
          target-repository: DRAMINGLING/Documents
          target-branch: main
          source-directory: '.'
          
          # ⚠️ 指定目标目录，可以使用根目录或子目录
          destination-directory: 'Algebraic Varieties'
          
          # ⚠️ 只推送重命名后的PDF文件
          file-filter: 'Note for Algebraic Varieties.pdf'
          
          # ⚠️ 自定义提交信息
          commit-message: "Add 'Note for Algebraic Varieties' PDF from release ${{ github.event.release.tag_name }}"
          
          # 如果需要，创建目标目录
          create-target-directory-if-needed: true
          
          force: true
