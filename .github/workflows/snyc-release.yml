name: 推送Release的main.pdf到Documents仓库

# 触发条件：可选（按需选择）
on:
  # 1. 手动触发（推荐测试用）
  workflow_dispatch:
  # 2. 当有新Release发布时自动触发
  release:
    types: [published]

jobs:
  push-pdf:
    runs-on: ubuntu-latest
    steps:
      # ==================== 步骤1：拉取源仓库代码（获取Release上下文） ====================
      - name: 检出源仓库代码
        uses: actions/checkout@v4

      # ==================== 步骤2：下载Release中的main.pdf文件 ====================
      - name: 下载Release资产（main.pdf）
        uses: dawidd6/action-download-artifact@v6
        with:
          # 【需修改】源仓库的所有者/仓库名（例：octocat/源仓库名）
          repo: DRAMINGLING/Note_for_Algebraic_Varieties
          # 【需修改】Release的标签（例：v1.0.0，或用动态值 github.event.release.tag_name）
          tag: ${{ github.event.release.tag_name || 'release' }}
          # 仅下载main.pdf（精准匹配）
          name: main.pdf
          # 下载到临时目录
          path: ./tmp-pdf

      # ==================== 步骤3：检出目标Documents仓库 ====================
      - name: 检出目标Documents仓库
        uses: actions/checkout@v4
        with:
          # 【需修改】目标仓库的HTTPS地址（例：https://github.com/octocat/Documents.git）
          repository: DRAMINGLING/Documents
          # 【需修改】目标仓库的分支（例：main/master）
          ref: main
          # 目标仓库的本地检出目录
          path: ./target-repo
          # 【核心】用于推送的Token（需提前在GitHub设置Personal Access Token，权限含repo）
          token: ${{ secrets.UPDATE_TEX_FILE }}

      # ==================== 步骤4：复制PDF到目标仓库并推送 ====================
      - name: 复制PDF到目标仓库
        run: |
          # 确保目标仓库目录存在（可选：指定子目录，如docs/pdf）
          mkdir -p ./target-repo
          # 复制下载的main.pdf到目标仓库（可修改目标文件名，如main-v1.0.0.pdf）
          cp ./tmp-pdf/main.pdf ./target-repo/Note for Algebraic Varieties.pdf
          # 进入目标仓库目录
          cd ./target-repo
          # 配置Git用户（Action默认无配置）
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          # 检查变更
          git add .
          git commit -m "chore: 同步源仓库Release的main.pdf（标签：${{ github.event.release.tag_name || 'release' }}）" || echo "无文件变更，无需提交"

      # ==================== 步骤5：推送到目标仓库（使用Action封装，避免原生Git） ====================
      - name: 推送到Documents仓库
        uses: ad-m/github-push-action@master
        with:
          # 目标仓库的本地路径
          directory: ./target-repo
          # 【需修改】目标仓库分支（与步骤3的ref一致）
          branch: main
          # 强制推送（可选，谨慎使用）
          force: true
          # 使用指定Token推送
          github_token: ${{ secrets.UPDATE_TEX_FILE }}
